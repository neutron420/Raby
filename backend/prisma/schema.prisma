

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}



model TransactionCache {
  txHash        String   
  networkId      String   
  accountAddress String  
  
  blockNumber   BigInt?
  timestamp     DateTime
  fromAddress   String
  toAddress     String?
  value         String   @default("0")
  gasUsed       String?
  gasPrice      String?
  status        String   // 'pending', 'confirmed', 'failed'
  direction     String   // 'sent', 'received'
  
  // Token transfer fields
  isTokenTransfer Boolean @default(false)
  contractAddress String?
  tokenSymbol     String?
  tokenName       String?
  tokenValue      String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Composite primary key ensures uniqueness per account's view of transaction
  @@id([txHash, networkId, accountAddress])
  @@index([accountAddress])
  @@index([networkId])
  @@index([timestamp])
  @@index([status])
}

// Cache for token balances (optional - to reduce API calls)
model TokenBalanceCache {
  id              String   @id @default(uuid())
  accountAddress  String   // Account that owns this token
  networkId       String   // 'sepolia' or 'mainnet'
  contractAddress String   // Token contract address (null for native currency)
  
  symbol          String
  name            String?
  decimals        Int
  balance         String   @default("0") // Raw balance (Wei, etc.)
  balanceFormatted String  // Human-readable balance
  
  lastUpdated     DateTime @default(now())
  createdAt       DateTime @default(now())

  @@unique([accountAddress, networkId, contractAddress])
  @@index([accountAddress])
  @@index([networkId])
  @@index([contractAddress])
}

// User preferences (for syncing settings across devices in future)
model UserPreferences {
  id                String   @id @default(uuid())
  deviceId          String   @unique // Unique device identifier
  
  preferredCurrency String   @default("USD")
  themePreference   String   @default("system") // 'system', 'light', 'dark'
  defaultGasLevel   String   @default("medium") // 'slow', 'medium', 'fast'
  biometricsEnabled Boolean  @default(false)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// Contacts/Address book (for future use)
model Contact {
  id            String   @id @default(uuid())
  deviceId      String   // Link to device
  
  name          String
  address       String   // Ethereum address
  networkId     String?  // Optional: 'sepolia' or 'mainnet'
  notes         String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([deviceId, address, networkId])
  @@index([deviceId])
  @@index([address])
}

// Accounts metadata (keys stay local; metadata synced to backend)
model Account {
  id              String   @id @default(uuid())
  deviceId        String
  name            String
  address         String
  derivationIndex Int
  derivationPath  String
  isActive        Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([deviceId, address])
  @@index([deviceId])
}
